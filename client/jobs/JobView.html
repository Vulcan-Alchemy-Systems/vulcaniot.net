<template name="JobView">
  {{#unless Template.subscriptionsReady}}{{> spinner}}{{/unless}}
  {{#if Template.subscriptionsReady}}
    <div id="alert"></div>
    <span style="margin-top:-42px;" class="pull-right">
      {{#if isInRole 'manager'}}
        <a href="#" title="Edit Job" class="btn btn-xs btn-warning job-edit"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a>
        <a href="#" title="Delete Job" class="btn btn-xs btn-danger job-delete"><i class="fa fa-trash" aria-hidden="true"></i> Delete</a>
      {{/if}}
      <a href="#" title="Back to job list" class="btn btn-xs btn-primary job-view" ><i class="fa fa-reply" aria-hidden="true"></i> Back</a>
    </span>

      <div class="row">
        <div class="col-xs-12">
          <p><b>Job Name:</b> {{job.jobName}}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <p><b>Description:</b> {{job.jobDescription}}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-4">
          <p><b>Start:</b> {{longDateFormat job.jobStartDate}}</p>
        </div>
        <div class="col-xs-12 col-sm-4">
          <p><b>Expected:</b> {{longDateFormat job.jobExpectedCompleteDate}}</p>
        </div>
        <div class="col-xs-12 col-sm-4">
          <p><b>Completed:</b> {{#if job.jobCompleteDate}}{{longDateFormat job.jobCompleteDate}}{{else}}Not Completed{{/if}}</p>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-sm-4">
          <p><b>Created By:</b> {{job.createdByName}}</p>
        </div>
        <div class="col-xs-12 col-sm-4">
          <p><b>Created:</b> {{longDateFormat job.createdAt}}</p>
        </div>
        <div class="col-xs-12 col-sm-4">
          <p><b>External Reporting:</b> {{externalReporting job.externalReporting}}</p>
        </div>
      </div>

      <br />

      <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#notes" data-toggle="tab">Notes</a></li>
          <li><a href="#products" data-toggle="tab">Products</a></li>
          <li><a href="#transfer" data-toggle="tab">Transfer</a></li>
        </ul>
        <div class="tab-content">
          <!-- Notes -->
          <div class="active tab-pane" id="notes">
            {{#if $.Session.get 'JobNoteNew'}}
              {{> JobNoteNew}}
            {{else}}
              <a href="#" title="New Note" class="btn btn-xs btn-success job-note-new pull-right" style="margin-top:-48px;"><i class="fa fa-plus" aria-hidden="true"></i> New</a>
              {{#each job.jobNotes}}
                {{#if isInRole 'employee'}}

                <div class="panel panel-default">
                  <div class="panel-body">
                    <p>{{note}}</p>
                    <p class="small text-muted">
                      <i class="fa fa-user" aria-hidden="true"></i> {{createdByName}} <i class="fa fa-clock" aria-hidden="true"></i> {{longDateFormat createdAt}}
                        {{#if customerView}}<span class="pull-right text-success"><i class="fa fa-check" aria-hidden="true"></i> Customer Can Read</span>{{else}}<span class="pull-right text-danger"><i class="fa fa-info-circle" aria-hidden="true"></i> Hidden From Customer</span>{{/if}}
                    </p>
                  </div>
                </div>
                {{else}}
                  {{#if customerView}}
                    <div class="panel panel-default">
                      <div class="panel-body">
                        <p>{{note}}</p>
                        <p class="small text-muted">
                          <i class="fa fa-user" aria-hidden="true"></i> {{createdByName}} <i class="fa fa-clock" aria-hidden="true"></i> {{longDateFormat createdAt}}
                            {{#if customerView}}<span class="pull-right text-success"><i class="fa fa-check" aria-hidden="true"></i> Customer Can Read</span>{{/if}}
                        </p>
                      </div>
                    </div>
                    {{/if}}
                  {{/if}}
                {{else}}
                  <div class="alert alert-info">
                    <p><i class="fa fa-info-circle" aria-hidden="true"></i> No Notes</p>
                  </div>
                {{/each}}
            {{/if}}
          </div>

          <!-- Products -->
          <div class="active tab-pane" id="products">
            {{#if $.Session.get 'JobProductNew'}}
              {{> JobProductNew}}
            {{else}}
              <a href="#" title="New Product" class="btn btn-xs btn-success job-product-new pull-right" style="margin-top:-48px;"><i class="fa fa-plus" aria-hidden="true"></i> New</a>
              <table class="table table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Qty</th>
                    <th>Weight</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="4"><i class="fa fa-info-circle" aria-hidden="true"></i> No Products</td>
                  </tr>
                </tbody>
              </table>
            {{/if}}
          </div>
          <!-- Products -->

          <!-- transfer -->
          <div class="active tab-pane" id="transfer">
            {{#if $.Session.get 'JobTransferNew'}}
              {{> JobTransferNew}}
            {{else}}

            {{/if}}
          </div>
          <!-- transfer -->
        </div>
      </div>

  {{/if}}
</template>
